# 📦 改进版 Hexo 备份脚本使用指南

## ✨ 新增功能

### 新增两个轻量化备份选项

**4) 纯内容备份** - 排除照片和视频
- 仅备份文章、主题、配置等文本内容
- 文件小，速度快，适合日常备份
- 推荐频率：每周备份

**5) 仅媒体备份** - 只备份照片和视频
- 仅备份 `source/img/` 和 `source/videos/`
- 适合添加照片后的增量备份
- 推荐频率：添加照片后立即备份

---

## 🎯 五种备份模式对比

| 模式 | 文章 | 配置 | 主题 | 照片 | 视频 | Git | Web配置 | 文件大小 | 适用场景 |
|------|------|------|------|------|------|-----|---------|---------|---------|
| 1️⃣ 快速 | ✅ | ✅ | ❌ | ✅ | ✅ | ❌ | ❌ | 大 | 基础备份 |
| 2️⃣ 完整 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | 很大 | 完整备份 |
| 3️⃣ 迁移 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 最大 | 服务器迁移 |
| 4️⃣ 纯内容 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | 小 | 日常备份 ⭐ |
| 5️⃣ 仅媒体 | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | 大 | 照片增量备份 ⭐ |

---

## 📝 使用方法

### 1. 上传修改后的脚本

```bash
# 上传到服务器
scp D:\TC\AI-Scripts\Hexo\hexo_manager.sh root@服务器IP:/var/www/hexo-blog/

# 设置执行权限
ssh root@服务器IP
chmod +x /var/www/hexo-blog/hexo_manager.sh
```

### 2. 运行备份

```bash
cd /var/www/hexo-blog
./hexo_manager.sh
```

选择 `3) 备份博客数据`，会看到新的菜单：

```
备份模式：
1) 快速备份（仅源文件和配置，适合日常备份）
2) 完整备份（包含所有配置、主题、脚本，推荐）
3) 迁移备份（包含Git仓库和Web配置，用于完整迁移）

轻量化备份（推荐）：
4) 纯内容备份（排除照片和视频，轻量快速）
5) 仅媒体备份（仅备份照片和视频文件）
0) 返回

请选择 [0-5]:
```

---

## 🎓 使用示例

### 示例1：日常文章备份（推荐）

```bash
./hexo_manager.sh
# 选择 3) 备份博客数据
# 选择 4) 纯内容备份
```

**输出示例：**
```
[INFO] 已选择：纯内容备份（排除照片和视频）
[INFO]   → 适合日常文章备份，文件小速度快
[INFO] 备份源文件...
[INFO]   → 备份源文件（排除照片和视频）
[SUCCESS]   ✓ 已使用rsync排除媒体文件
[INFO]   → 已排除照片: 134 个，420M
[INFO]   → 已排除视频: 5 个，850M
...
[SUCCESS] 备份完成！
[INFO] 文件大小: 15M  ← 很小！
```

### 示例2：添加照片后备份

```bash
# 先上传新照片到 /var/www/hexo-blog/source/img/
# 然后运行媒体备份

./hexo_manager.sh
# 选择 3) 备份博客数据
# 选择 5) 仅媒体备份
```

**输出示例：**
```
[INFO] 已选择：仅媒体备份（仅备份照片和视频）
[INFO]   → 适合添加照片后的增量备份
[INFO] 备份源文件...
[INFO]   → 仅备份媒体文件（照片和视频）
[INFO]   → 复制照片目录...
[SUCCESS]   ✓ 照片: 145 个文件，大小: 450M
[INFO]   → 复制视频目录...
[SUCCESS]   ✓ 视频: 8 个文件，大小: 1.2G
...
[SUCCESS] 备份完成！
[INFO] 文件大小: 520M
```

### 示例3：月度完整备份

```bash
./hexo_manager.sh
# 选择 3) 备份博客数据
# 选择 2) 完整备份
```

---

## 💡 推荐的备份策略

### 策略A：轻量级（推荐给媒体文件多的用户）

| 时间 | 备份类型 | 说明 |
|------|---------|------|
| **每周一** | 纯内容备份(4) | 备份文章、主题、配置 |
| **每月1号** | 完整备份(2) | 包含所有内容 |
| **添加照片后** | 仅媒体备份(5) | 快速备份新照片 |

**优点：**
- 日常备份很快（几十MB）
- 媒体单独备份，可控
- 节省存储空间

### 策略B：传统全量（适合媒体文件少的用户）

| 时间 | 备份类型 | 说明 |
|------|---------|------|
| **每周** | 完整备份(2) | 包含所有内容 |
| **每月** | 迁移备份(3) | 最完整的备份 |

---

## 📊 备份文件大小对比

以你的博客为例（134张照片，约400MB）：

| 备份类型 | 预计大小 | 压缩后 | 备份时间 |
|---------|---------|--------|---------|
| 纯内容备份 | ~50MB | ~15MB | 10秒 ⚡ |
| 仅媒体备份 | ~400MB | ~350MB | 40秒 |
| 完整备份 | ~450MB | ~380MB | 50秒 |

当照片增加到500张、视频50个后：

| 备份类型 | 预计大小 | 压缩后 | 备份时间 |
|---------|---------|--------|---------|
| 纯内容备份 | ~50MB | ~15MB | 10秒 ⚡⚡⚡ |
| 仅媒体备份 | ~6.5GB | ~5.8GB | 10分钟 |
| 完整备份 | ~6.6GB | ~5.9GB | 12分钟 |

**结论：纯内容备份的速度优势会越来越明显！**

---

## 🔧 高级技巧

### 技巧1：定时自动备份

创建 cron 任务：

```bash
# 编辑 crontab
crontab -e

# 添加以下行（每周一凌晨2点自动执行纯内容备份）
0 2 * * 1 cd /var/www/hexo-blog && echo "4" | ./hexo_manager.sh

# 每月1号凌晨3点执行完整备份
0 3 1 * * cd /var/www/hexo-blog && echo "2" | ./hexo_manager.sh
```

### 技巧2：查看备份历史

```bash
# 查看所有备份
ls -lh /var/backups/hexo-blog/*.tar.gz

# 按类型查看
ls -lh /var/backups/hexo-blog/*content_only*.tar.gz  # 纯内容备份
ls -lh /var/backups/hexo-blog/*media_only*.tar.gz   # 媒体备份
ls -lh /var/backups/hexo-blog/*full*.tar.gz         # 完整备份
```

### 技巧3：备份文件分类存储

```bash
# 创建分类目录
mkdir -p /var/backups/hexo-blog/{content,media,full}

# 移动备份文件到对应目录
mv /var/backups/hexo-blog/*content_only* /var/backups/hexo-blog/content/
mv /var/backups/hexo-blog/*media_only* /var/backups/hexo-blog/media/
mv /var/backups/hexo-blog/*full* /var/backups/hexo-blog/full/
```

---

## ✅ 验证备份是否成功

### 检查备份内容

```bash
# 解压查看备份内容（不实际恢复）
cd /var/backups/hexo-blog
tar -tzf hexo_backup_content_only_20251102_230000.tar.gz | head -20

# 应该看到：
# hexo_backup_content_only_20251102_230000/
# hexo_backup_content_only_20251102_230000/source/
# hexo_backup_content_only_20251102_230000/source/_posts/
# hexo_backup_content_only_20251102_230000/source/gallery/
# ...（但没有 img/ 和 videos/）
```

### 检查媒体备份

```bash
tar -tzf hexo_backup_media_only_20251102_230100.tar.gz | grep -E "(img|videos)"

# 应该只看到：
# hexo_backup_media_only_20251102_230100/source/img/
# hexo_backup_media_only_20251102_230100/source/videos/
```

---

## 🎉 总结

### 新功能优势

✅ **节省空间** - 纯内容备份比完整备份小90%+  
✅ **速度快** - 10秒vs10分钟，快60倍  
✅ **灵活性** - 可以分别备份内容和媒体  
✅ **易管理** - 不同类型备份可分开存储  

### 立即开始使用

1. 上传修改后的脚本到服务器
2. 运行一次纯内容备份测试（选项4）
3. 对比文件大小，感受速度提升
4. 制定适合你的备份策略

**开始享受高效备份吧！** 🚀
